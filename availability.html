<html>
<head>
	<title>Workout Availability</title>
	<meta charset="utf-8">
  <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
  <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
	<!-- <script src="mainpage.js"></script> -->

	<link rel="stylesheet" type="text/css" href="availability.css">
</head>
<body>
	<div id="container">
		<nav class="btn-group">
			<button><a href="mainpage.html"><strong>Home Page</strong></a></button>
			<button><a href="about.html"><strong>About Us</strong></a></button>
			<button><a href="matchespage.html"><strong>Go to your Matches</strong></a></button>
			<button><a href="preferenceEditor.html"><strong>Go to your Preference Editor</strong></a></button>
			<button><a href="profilepage.html"><strong>Go to your Profile</strong></a></button>
			<button><a href="availability.html"><strong>Select your Availability</strong></a></button>
      <button><a href="contact.html"><strong>Contact Us</strong></a></button>
			<button id="btnSignOut" onclick="firebase.auth().signOut();" onclick="window.location = 'signin.html'"><strong>Logout</strong></button>
		</nav>

		<div id="availability">
			<h1 id="h1id">Availability Selection</h1>
			<div id="selectDay">
				<select id="daysOfWeek">
					<option value="Monday">Monday</option>
					<option value="Tuesday">Tuesday</option>
					<option value="Wednesday">Wednesday</option>
					<option value="Thursday">Thursday</option>
					<option value="Friday">Friday</option>
					<option value="Saturday">Saturday</option>
					<option value="Sunday">Sunday</option>
				</select>
			</div>
			<div id="selectHour">
				<select id="hour">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
			</div>
			<div id="selectTimeOfDay">
				<select id="timeOfDay">
					<option value="AM">AM</option>
					<option value="PM">PM</option>
				</select>
			</div>
				<br/>
			<div id="button">
				<button id="btnSubmit" type="submit">Submit</button>
			</div>
				<p id="availP"></p>
		</div>
	</div>

	<script>
	function deleteEntry(k) {


		var allCurrentTimesArr = document.getElementsByClassName("availEntries");

		var updatedEntryString = ""; // reads as undefined if I don't specify it's a string

		var entryToBeDeleted = "";


		for (var i = 0; i < allCurrentTimesArr.length; i++) {
			if (i == k) {
				entryToBeDeleted = allCurrentTimesArr[i].innerText;
			} else {
				// add entry to string that will be used for updating availability section under user
				updatedEntryString += allCurrentTimesArr[i].innerText + ", ";
			}
		}

		entryToBeDeleted = entryToBeDeleted.split(" ");

		console.log("new list is   " + updatedEntryString);

		/* I have my new string that will be used to update firebase without the clicked entry
		 	need to call firebase now to update Availability field */


		var fbRef = firebase.database().ref();
		var fbRefUsers = firebase.database().ref().child('Users');
		var fbUid = firebase.auth().currentUser.uid;


		// delete time entry under day
		fbRef.child(entryToBeDeleted[0]).child(entryToBeDeleted[1]).child(fbUid).remove();


		fbRefUsers.child(fbUid).update({
			Availability: updatedEntryString
		});



		/* Reloads page to avoid the printing of a second list on page with deleted entry,
		 	by reloading it quickly fixes this problem. Look for another possible solution. */
		location.reload();
		/* need to "reset the view of availability times" */


  }
	</script>

	<script src="availability.js"></script>

</body>
</html>
